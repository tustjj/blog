---
title: 指标容量预测
date: '2021-12-02'
tags: ['算法总结']
draft: true
summary: 对于变化趋势比较稳定的指标数据，学习时间序列变化规律，对未来做预测，可用于提前发现容量瓶颈或寻找内存泄漏的潜在迹象
---

# 

先提取报告的关键字，然后用关键字集合之间的相似程度来计算报告之间的相似度

# 预处理

## 降采样

按时间分片，取各分片的最大值/最小值/均值/中位数，作为降采样后的原始数据。否则还是用降采样之前的原始数据。

## 推测采样时间间隔

1. 统计该时间序列的各采样间隔的出现频数，并过滤小于等于0的interval
2. 查找出现频率超过80%的interval，如果存在则直接返回该interval
3. 出现没有出现频率超过80%的interval，则查找出现频率超过20%的interval，且其整数倍的出现频率超过80%
4. 查找出现频率最高的interval（此时数据大概率存在大面积、不规则缺失），且大于该interval的频率之和超过80%，则直接返回返回该interval，否则记录日志，自动推测采样间隔失败，使用最频繁的采样间隔

## 填充缺失数据

按照采样间隔，进行线性差值，比如 1,4,x,x,x,12 -> 1,4,6,8,10,12

## 平滑数据

对时间序列做平滑处理，将极值替换为upper和lower，upper和lower按照 mean +- k * std 计算得到

## 指标特征提取

### 趋势类型推测

根据给定时间序列推测算法参数-趋势类型，步骤如下：
1. 如果训练集长度少于4天，则查看差值列表。
    1.1 如果差值为0的比例大于80%，则认为无趋势；如果差值大于等于0的比例大于80%，则认为存在上涨趋势；
    1.2 如果差值小于等于0的比例大于80%，则认为存在下降趋势；否则认为无趋势
2. 如果训练集长度大于4天，则计算每日均值列表。
    2.1 遍历均值列表，对上升趋势和下降趋势计分
    2.2 如果上升趋势分得分超过均值列表的30%，且得分大于下降趋势得分，则认为曲线具有上升趋势
    2.3 如果下降趋势分得分超过均值列表的30%，且得分大于上升趋势得分，则认为曲线具有下降趋势
    2.4 否则认为无趋势
    
### 极值推测

推测数据集的极值，最小值和最大值，步骤如下：
1. 取训练集前半部分的最大值和最小值为极值。遍历训练集后半部分，如果极大/小值可用，则容忍度为正数；
2. 接着判断极大/小值是否远离所有点，最终如果容忍度为正数，则代表有有极值，否则没有极值 
   
### 指标类型推测

1. 没有趋势，且包含关键字 amt、tps、trans，认为是 周期性指标
2. 包含关键字 pct、percent、ratio、率，认为是 率型指标，如果最大值小于等于1，则是ratio类型，否则是percent类型
3. 数据范围在0 - 1 范围内，则认为是ratio类型
4. 数据全都是正数，则是positive类型
5. 数据全都是负数，则是negative类型

### 指标周期性推测

1. 训练数据长度 大于 2周
2. 获取最近一个月内的数据点作为数据集，如果数据点在节假日范围内，则以周为单位向前后找可以替代的数据点；
3. 对数据集进行差值填充，对数据集进行差值填充，训练集的时间戳均在节假日内，且没有找到可替代的数据点，则直接使用训练集做周期性推测
4. 计算数据集中各数据点的标准差倍数，并计算周/半周/天的关联系数，如果满足条件，则认为曲线类型为Period

### 指标周期长度

### 数据开始时间和结束时间

## 校验模型参数

## 周期型模型

### 预处理

1. 过滤一些不考虑的时间段数据
2. 按月分组，标记极值（极值占比不超过5%，阈值采用sigma*差值中位数），去除掉特殊节假日的极值点
3. 填充缺失值，线性插值，如果缺失时间大于3小时则不予填充
4. 加载节假日数据，包括内置节假日、全局节假日、全局调休日、去年节假日和今天相比是否发生变化
5. 解析额外的节假日数据
6. 训练数据（时序数据集，采样间隔，周期间隔）
7. 如果存在

## 趋势性模型
